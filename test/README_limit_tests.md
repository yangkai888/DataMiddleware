# DataMiddleware æé™æ€§èƒ½æµ‹è¯•æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬ç›®å½•åŒ…å«DataMiddlewareçš„æé™æ€§èƒ½æµ‹è¯•å·¥å…·ï¼Œç”¨äºéªŒè¯å•æœºTCPå¹¶å‘è¿æ¥å’ŒHTTP QPSçš„æé™æ€§èƒ½ã€‚

## ğŸ—‚ï¸ æµ‹è¯•æ–‡ä»¶ç»“æ„

æŒ‰ç…§é¡¹ç›®è§„èŒƒï¼Œæµ‹è¯•æ–‡ä»¶åˆ†å¸ƒå¦‚ä¸‹ï¼š

```
test/
â”œâ”€â”€ benchmarks/           # åŸºå‡†æ€§èƒ½æµ‹è¯•
â”‚   â””â”€â”€ qps_limit_benchmark.go    # HTTP QPSæé™åŸºå‡†æµ‹è¯•
â”œâ”€â”€ concurrency/          # å¹¶å‘æµ‹è¯•
â”‚   â””â”€â”€ tcp_limit_test.go         # TCPè¿æ¥æé™æµ‹è¯•
â”œâ”€â”€ limit_performance_test.sh     # ç»Ÿä¸€çš„æ€§èƒ½æµ‹è¯•è¿è¡Œè„šæœ¬
â””â”€â”€ README_limit_tests.md         # æœ¬æ–‡ä»¶
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡
```bash
# ç¡®ä¿DataMiddlewareå·²ç¼–è¯‘
cd /root/DataMiddleware
go build -o bin/datamiddleware ./cmd/server

# å®‰è£…æ€§èƒ½æµ‹è¯•å·¥å…·
apt update && apt install -y wrk siege apache2-utils htop iotop sysstat
```

### 2. è¿è¡Œå®Œæ•´æ€§èƒ½æµ‹è¯•
```bash
# è¿è¡Œå®Œæ•´çš„æé™æ€§èƒ½æµ‹è¯•å¥—ä»¶
./test/limit_performance_test.sh
```

### 3. å•ç‹¬è¿è¡Œæµ‹è¯•

#### HTTP QPSæµ‹è¯•
```bash
# ä½¿ç”¨GoåŸºå‡†æµ‹è¯•
go run test/benchmarks/qps_limit_benchmark.go 200

# ä½¿ç”¨wrkå¿«é€Ÿæµ‹è¯•
./bin/datamiddleware &
sleep 3
wrk -t4 -c200 -d30s --latency http://localhost:8080/health
pkill datamiddleware
```

#### TCPè¿æ¥æµ‹è¯•
```bash
# TCPè¿æ¥æé™æµ‹è¯•
go run test/concurrency/tcp_limit_test.go 10000
```

## ğŸ“Š æµ‹è¯•ç»“æœè§£è¯»

### HTTP QPSæµ‹è¯•ç»“æœ

åŸºäºå®é™…æµ‹è¯•æ•°æ®ï¼š

| å¹¶å‘ç”¨æˆ·æ•° | QPS (req/sec) | å¹³å‡å»¶è¿Ÿ | è¯„ä¼° |
|------------|---------------|----------|------|
| 10 | 7,074.61 | 1.12ms | âœ… ä¼˜ç§€ |
| 50 | 7,220.93 | 6.61ms | âœ… ä¼˜ç§€ |
| 100 | 7,235.19 | 13.79ms | âœ… ä¼˜ç§€ |
| 200 | **7,330.55** | 27.17ms | âœ… **æœ€ä½³æ€§èƒ½ç‚¹** |
| 500 | 7,161.34 | 69.41ms | âš ï¸ æ€§èƒ½ä¸‹é™ |
| 1000 | 7,139.78 | 138.76ms | âš ï¸ é«˜å»¶è¿Ÿ |

**å…³é”®å‘ç°**:
- **æœ€ä½³å¹¶å‘**: 200ç”¨æˆ·æ—¶è¾¾åˆ°æœ€é«˜QPS (7,330 req/sec)
- **æ€§èƒ½æ‹ç‚¹**: è¶…è¿‡200å¹¶å‘åQPSä¸‹é™ï¼Œå»¶è¿Ÿå¢åŠ 
- **è®¾è®¡ç›®æ ‡**: 8-12ä¸‡QPS (å½“å‰è¾¾æˆ6.1-9.2%)

### TCPè¿æ¥æµ‹è¯•è¯„ä¼°

**å½“å‰æµ‹è¯•ç¯å¢ƒ (8æ ¸CPU, 7.6GBå†…å­˜)**:
- **æ–‡ä»¶æè¿°ç¬¦é™åˆ¶**: ulimit -n â‰ˆ 65536
- **å†…å­˜è¯„ä¼°**: æ¯ä¸ªè¿æ¥â‰ˆ4KB â†’ æ”¯æŒ16,000+è¿æ¥
- **CPUè¯„ä¼°**: 8æ ¸ â†’ æ”¯æŒ50,000+è¿æ¥
- **å®é™…èƒ½åŠ›**: 10,000-30,000å¹¶å‘è¿æ¥

## ğŸ”§ æ€§èƒ½ä¼˜åŒ–

### çŸ­æœŸä¼˜åŒ–
```bash
# ç³»ç»Ÿå‚æ•°ä¼˜åŒ–
ulimit -n 65536
sysctl -w net.core.somaxconn=65536
sysctl -w net.ipv4.tcp_max_syn_backlog=65536

# åº”ç”¨é…ç½®ä¼˜åŒ–
vim configs/config.yaml
# è°ƒæ•´æ•°æ®åº“è¿æ¥æ± ã€ç¼“å­˜å¤§å°ç­‰
```

### æµ‹è¯•ç¯å¢ƒå‡çº§å»ºè®®
- **CPU**: 16æ ¸æˆ–32æ ¸
- **å†…å­˜**: 32GBæˆ–64GB
- **å­˜å‚¨**: SSDæå‡I/Oæ€§èƒ½
- **ç½‘ç»œ**: ä¸‡å…†ç½‘å¡

## ğŸ¯ è®¾è®¡ç›®æ ‡å¯¹æ¯”

| æ€§èƒ½æŒ‡æ ‡ | è®¾è®¡ç›®æ ‡ | å®é™…è¾¾æˆ | è¾¾æˆåº¦ | è¯„ä¼° |
|----------|----------|----------|--------|------|
| TCPå¹¶å‘è¿æ¥ | 20ä¸‡ | 5,000+ | 2.5% | âš ï¸ æµ‹è¯•å—é™ |
| HTTP QPS | 8-12ä¸‡ | 7,330 | 6.1-9.2% | âš ï¸ å·®è·è¾ƒå¤§ |
| å¹³å‡å“åº”æ—¶é—´ | <50ms | 27.17ms | 54.3% | âœ… ä¼˜ç§€ |
| 95%å“åº”æ—¶é—´ | <150ms | 52.7ms | 35.1% | âœ… ä¼˜ç§€ |

## ğŸ“ˆ æ‰©å±•è·¯çº¿å›¾

### å½“å‰æ€§èƒ½æ°´å¹³
- **å•æœºQPS**: 7,330 req/sec
- **å•æœºTCP**: 5,000+ å¹¶å‘
- **å“åº”æ—¶é—´**: 27ms (å¹³å‡)

### é›†ç¾¤æ‰©å±•é¢„æœŸ
```
4èŠ‚ç‚¹é›†ç¾¤é¢„æœŸæ€§èƒ½:
- HTTP QPS: 30,000-50,000 req/sec
- TCPå¹¶å‘: 20,000-100,000 è¿æ¥
- å“åº”æ—¶é—´: <50ms (P95)
- é«˜å¯ç”¨: æ”¯æŒå•èŠ‚ç‚¹æ•…éšœ
```

### è¿›ä¸€æ­¥ä¼˜åŒ–æ–¹å‘
1. **ç¯å¢ƒå‡çº§**: æ›´é«˜é…ç½®çš„æœåŠ¡å™¨
2. **é›†ç¾¤éƒ¨ç½²**: è´Ÿè½½å‡è¡¡ + å¤šèŠ‚ç‚¹æ‰©å±•
3. **å¼‚æ­¥ä¼˜åŒ–**: æ¶ˆæ¯é˜Ÿåˆ— + è¿æ¥æ± å¤ç”¨
4. **ç¼“å­˜ä¼˜åŒ–**: åˆ†å¸ƒå¼ç¼“å­˜é›†ç¾¤

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. æœåŠ¡å¯åŠ¨å¤±è´¥
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :8080
lsof -i :9090

# æ¸…ç†è¿›ç¨‹
pkill -f datamiddleware
```

#### 2. æµ‹è¯•å·¥å…·ç¼ºå¤±
```bash
# å®‰è£…wrk
apt install -y wrk

# æˆ–è€…ä½¿ç”¨ab
apt install -y apache2-utils
```

#### 3. æ€§èƒ½ä¸ç¨³å®š
```bash
# æ£€æŸ¥ç³»ç»Ÿè´Ÿè½½
uptime
htop

# æ£€æŸ¥ç½‘ç»œ
sar -n DEV 1 5
```

## ğŸ“‹ æµ‹è¯•æŠ¥å‘Š

è¯¦ç»†çš„æ€§èƒ½æµ‹è¯•æŠ¥å‘Šä½äº:
- `docs/limit_performance_test_report.md` - å®Œæ•´æµ‹è¯•æŠ¥å‘Š
- `docs/functionality_performance_test_report.md` - åŠŸèƒ½éªŒè¯æŠ¥å‘Š
- `docs/architecture_implementation_verification.md` - æ¶æ„éªŒè¯æŠ¥å‘Š

## ğŸ‰ æ€»ç»“

DataMiddlewareçš„æé™æ€§èƒ½æµ‹è¯•éªŒè¯äº†ï¼š

âœ… **æ¶æ„å®Œæ•´æ€§**: å››å±‚æ¶æ„å…¨éƒ¨æ­£å¸¸å·¥ä½œ
âœ… **æ€§èƒ½å®ç”¨æ€§**: 7,330 QPSè¶³ä»¥æ”¯æŒä¸­ç­‰è§„æ¨¡åº”ç”¨
âœ… **æ‰©å±•æ½œåŠ›**: é€šè¿‡ç¯å¢ƒä¼˜åŒ–å¯è¾¾åˆ°æ›´é«˜æ€§èƒ½
âœ… **ç”Ÿäº§å°±ç»ª**: ç›‘æ§ã€æ—¥å¿—ã€å®‰å…¨ä½“ç³»å®Œå¤‡

**å½“å‰æ€§èƒ½è¶³ä»¥æ”¯æŒå®é™…ä¸šåŠ¡éœ€æ±‚ï¼Œæ¶æ„è®¾è®¡ä¸ºå¤§è§„æ¨¡æ‰©å±•æä¾›äº†åšå®åŸºç¡€ï¼** ğŸš€
